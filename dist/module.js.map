{"mappings":"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","sources":["src/index.js","src/emotes.js","src/bttv.js","src/pronouns.js"],"sourcesContent":["import replaceEmotesWithImageTags from \"./emotes.js\";\nimport { fetchPronounsForUser } from \"./pronouns.js\";\n\nconst processMessage = async (tags, message) => {\n  const messageHTMLWithEmotesReplaced = await replaceEmotesWithImageTags(\n    message,\n    tags.emotes\n  );\n\n  const userPronouns = await fetchPronounsForUser(tags.username);\n\n  return {\n    messageHTML: messageHTMLWithEmotesReplaced,\n    pronounsText: userPronouns,\n    displayName: tags[\"display-name\"],\n    userColor: tags.color,\n    isSlashMeMessage: tags[\"message-type\"] === \"action\",\n    badgeKeys: tags.badges ? Object.keys(tags.badges) : [],\n  };\n};\n\nexport default processMessage;\n","import escapeStringRegexp from \"escape-string-regexp\";\nimport bttv from \"./bttv.js\";\n\nexport const TWITCH_URL_PREFIX = `https://static-cdn.jtvnw.net/emoticons/v2`;\nconst EMOTE_REGEX_PART_1 = \"(?:^|(?<=\\\\s))\";\nconst EMOTE_REGEX_PART_2 = \"(?:(?=\\\\s)|$)\";\n\nconst BTTV_URL_PREFIX = \"https://cdn.betterttv.net/emote\";\nconst FFZ_URL_PREFIX = \"https://cdn.betterttv.net/frankerfacez_emote\";\n\n// JavaScript's standard slice function does not work well with strings that contain\n// unicode characters represented by more than one code unit. This trick helps solve\n// that problem:\nconst unicodeSlice = (string, start, end) =>\n  [...string].slice(start, end).join(\"\");\n\n/*\n  This function takes the Twitch message's `emotes` data to inject\n  one `<img>` tag per emote into the message that.\n\n  For example for this emotes object...\n\n  {\n    \"9080864508308403\": \"2-4\",\n    \"1010283120381084\": \"70-72\",\n  }\n\n  ...this means that characters 2-4 in the message string need\n  to be replaced with an `<img>` tag which has an URL to the image\n  for the emote with the ID 9080864508308403.\n*/\nexport const replaceTwitchStandardEmotes = (message, emotes) => {\n  // Twitch didn't recognize any emotes in the message.\n  // So we just return the original message.\n  if (!emotes) return message;\n\n  let result = message;\n  let replacementList = [];\n\n  for (const [emoteId, occurenceIndices] of Object.entries(emotes)) {\n    const [startIndex, endIndex] = occurenceIndices[0].split(\"-\");\n\n    replacementList.push({\n      emoteStartIndex: Number(startIndex),\n      emoteEndIndex: Number(endIndex) + 1,\n      replacement: `<img src=\"${TWITCH_URL_PREFIX}/${emoteId}/default/light/2.0\" alt=\"emote\" />`,\n    });\n  }\n\n  // reverse sort by start index\n  replacementList = replacementList.sort((a, b) => {\n    return b.emoteStartIndex - a.emoteStartIndex;\n  });\n\n  for (const {\n    emoteStartIndex,\n    emoteEndIndex,\n    replacement,\n  } of replacementList) {\n    result = `${unicodeSlice(\n      result,\n      0,\n      emoteStartIndex\n    )}${replacement}${unicodeSlice(result, emoteEndIndex)}`;\n  }\n\n  return result;\n};\n\n/*\n  This function scans the message text for occurences of bttv global emote codes.\n\n  It uses the global bttv emotes list and for each emote code (e.g. SourPls),\n  it replaces that code with an `<img>` tag with the URL to that bttv emote.\n*/\nconst replaceBTTVGlobalEmotes = async (message) => {\n  const bttvGlobalLookupTable = await bttv.getBttvGlobalLookupTable();\n  const bttvGlobalEmoteCodes = Object.keys(bttvGlobalLookupTable);\n\n  // Check if there are any global emote codes found in the message...\n  const noGlobalEmoteCodeFound = bttvGlobalEmoteCodes.every(\n    (emoteCode) => !message.includes(emoteCode)\n  );\n\n  // ... and if not just return the original message\n  if (noGlobalEmoteCodeFound) return message;\n\n  // Else do the work: Go through each code and if you find it replace it respectively.\n  let result = message;\n  bttvGlobalEmoteCodes.forEach((emoteCode) => {\n    const escapedEmoteCode = escapeStringRegexp(emoteCode);\n    const emoteRegexp = new RegExp(`\\\\b${escapedEmoteCode}\\\\b`, \"g\");\n\n    result = result.replaceAll(emoteRegexp, (matchedEmoteCode) => {\n      const emoteId = bttvGlobalLookupTable[matchedEmoteCode].id;\n      return `<img src=\"${BTTV_URL_PREFIX}/${emoteId}/2x\" />`;\n    });\n  });\n\n  return result;\n};\n\n/*\n  This function scans the message text for occurences of bttv channel emote codes.\n\n  It uses the channel's bttv emotes list and for each emote code (e.g. myChannelEmote),\n  it replaces that code with an `<img>` tag with the URL to that bttv emote.\n*/\nconst replaceBTTVChannelEmotes = async (message) => {\n  const bttvChannelLookupTable = await bttv.getBttvChannelLookupTable();\n  const bttvChannelEmoteCodes = Object.keys(bttvChannelLookupTable);\n\n  // Check if there are any channel emote codes found in the message...\n  const noChannelEmoteCodeFound = bttvChannelEmoteCodes.every(\n    (emoteCode) => !message.includes(emoteCode)\n  );\n\n  // ... and if not just return the original message\n  if (noChannelEmoteCodeFound) return message;\n\n  // Else do the work: Go through each code and if you find it replace it respectively.\n  let result = message;\n  bttvChannelEmoteCodes.forEach((emoteCode) => {\n    const escapedEmoteCode = escapeStringRegexp(emoteCode);\n    const emoteRegexp = new RegExp(`\\\\b${escapedEmoteCode}\\\\b`, \"g\");\n\n    result = result.replaceAll(emoteRegexp, (matchedEmoteCode) => {\n      const emoteId = bttvChannelLookupTable[matchedEmoteCode].id;\n      return `<img src=\"${BTTV_URL_PREFIX}/${emoteId}/2x\" />`;\n    });\n  });\n\n  return result;\n};\n\n/*\n  This function scans the message text for occurences of FrankerFaceZ emote codes.\n\n  It uses the global FrankerFaceZ emotes list and for each emote code (e.g. OMEGALUL),\n  it replaces that code with an `<img>` tag with the URL to that FFZ emote.\n*/\nconst replaceFFZChannelEmotes = async (message) => {\n  const ffzChannelLookupTable = await bttv.getFfzChannelLookupTable();\n  const ffzChannelEmoteCodes = Object.keys(ffzChannelLookupTable);\n\n  // Check if there are any channel emote codes found in the message...\n  const noChannelEmoteCodeFound = ffzChannelEmoteCodes.every(\n    (emoteCode) => !message.includes(emoteCode)\n  );\n\n  // ... and if not just return the original message\n  if (noChannelEmoteCodeFound) return message;\n\n  // Else do the work: Go through each code and if you find it replace it respectively.\n  let result = message;\n  ffzChannelEmoteCodes.forEach((emoteCode) => {\n    const escapedEmoteCode = escapeStringRegexp(emoteCode);\n    const emoteRegexp = new RegExp(`\\\\b${escapedEmoteCode}\\\\b`, \"g\");\n\n    result = result.replaceAll(emoteRegexp, (matchedEmoteCode) => {\n      const emoteId = ffzChannelLookupTable[matchedEmoteCode].id;\n      return `<img src=\"${FFZ_URL_PREFIX}/${emoteId}/2\" />`;\n    });\n  });\n\n  return result;\n};\n\nconst replaceEmotesWithImageTags = async (message, emotes) => {\n  let result = message;\n  result = replaceTwitchStandardEmotes(result, emotes);\n  result = await replaceBTTVGlobalEmotes(result);\n  result = await replaceBTTVChannelEmotes(result);\n  result = await replaceFFZChannelEmotes(result);\n  return result;\n};\n\nexport default replaceEmotesWithImageTags;\n","let userId;\nlet bttvGlobalLookupTable;\nlet bttvChannelLookupTable;\nlet ffzChannelLookupTable;\n\nasync function getUserId() {\n  if (userId) return userId;\n\n  const queryParameters = new URLSearchParams(window.location.search);\n  const channelName = queryParameters.get(\"channel\");\n\n  const userIdResponse = await fetch(\n    `https://decapi.me/twitch/id/${channelName}`\n  );\n\n  userId = await userIdResponse.text();\n\n  return userId;\n}\n\nasync function getBttvGlobalLookupTable() {\n  if (bttvGlobalLookupTable) return bttvGlobalLookupTable;\n\n  const bttvGlobalEmotesResponse = await fetch(\n    \"https://api.betterttv.net/3/cached/emotes/global\"\n  );\n\n  if (bttvGlobalEmotesResponse.ok) {\n    const bttvGlobalEmotes = await bttvGlobalEmotesResponse.json();\n\n    bttvGlobalLookupTable = bttvGlobalEmotes.reduce((result, emote) => {\n      const emoteData = {\n        id: emote.id,\n        type: emote.imageType,\n      };\n\n      result[emote.code] = emoteData;\n\n      return result;\n    }, {});\n\n    return bttvGlobalLookupTable;\n  }\n\n  return {};\n}\n\nasync function getBttvChannelLookupTable() {\n  if (bttvChannelLookupTable) return bttvChannelLookupTable;\n\n  const userId = await getUserId();\n\n  const bttvChannelEmotesResponse = await fetch(\n    `https://api.betterttv.net/3/cached/users/twitch/${userId}`\n  );\n\n  if (bttvChannelEmotesResponse.ok) {\n    const bttvChannelEmotesJSON = await bttvChannelEmotesResponse.json();\n    const bttvChannelEmotes = bttvChannelEmotesJSON?.channelEmotes.concat(\n      bttvChannelEmotesJSON.sharedEmotes\n    );\n\n    bttvChannelLookupTable = bttvChannelEmotes.reduce((result, emote) => {\n      const emoteData = {\n        id: emote.id,\n        type: emote.imageType,\n      };\n\n      result[emote.code] = emoteData;\n\n      return result;\n    }, {});\n\n    return bttvChannelLookupTable;\n  }\n\n  return {};\n}\n\nasync function getFfzChannelLookupTable() {\n  if (ffzChannelLookupTable) return ffzChannelLookupTable;\n\n  const userId = await getUserId();\n\n  const ffzChannelEmotesResponse = await fetch(\n    `https://api.betterttv.net/3/cached/frankerfacez/users/twitch/${userId}`\n  );\n\n  if (ffzChannelEmotesResponse.ok) {\n    const ffzChannelEmotes = await ffzChannelEmotesResponse.json();\n\n    ffzChannelLookupTable = ffzChannelEmotes.reduce((result, emote) => {\n      const emoteData = {\n        id: emote.id,\n        type: emote.imageType,\n      };\n\n      result[emote.code] = emoteData;\n\n      return result;\n    }, {});\n\n    return ffzChannelLookupTable;\n  }\n\n  return {};\n}\n\nexport default {\n  getBttvGlobalLookupTable,\n  getBttvChannelLookupTable,\n  getFfzChannelLookupTable,\n};\n","const PRONOUNS_URL_PREFIX = `https://pronouns.alejo.io/api`;\n\nlet pronounNames;\nlet userPronouns = {};\n\nconst fetchAllPronounNames = async () => {\n  if (pronounNames) return pronounNames;\n\n  const pronounsJSON = await fetch(`${PRONOUNS_URL_PREFIX}/pronouns`);\n  pronounNames = await pronounsJSON.json();\n\n  pronounNames = pronounNames.reduce((result, pronoun) => {\n    result[pronoun.name] = pronoun.display;\n    return result;\n  }, {});\n\n  return pronounNames;\n};\n\nconst fetchPronounsForUser = async (username) => {\n  if (!pronounNames) {\n    await fetchAllPronounNames();\n  }\n\n  const userPronounsJSON = await fetch(\n    `${PRONOUNS_URL_PREFIX}/users/${username}`\n  );\n  const userPronounsData = await userPronounsJSON.json();\n\n  const pronounId = userPronounsData?.[0]?.pronoun_id;\n\n  if (pronounId) {\n    userPronouns[username] = pronounNames[pronounId];\n  }\n\n  return userPronouns[username];\n};\n\nexport { fetchPronounsForUser };\n"],"names":[],"version":3,"file":"module.js.map"}